id: io.github.e_j_w.ChartOfNuclides
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: io.github.e_j_w.ChartOfNuclides
finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=fallback-x11
  # Wayland access
  - --socket=wayland
  # GPU acceleration
  - --device=dri
  # Gamepad support
  - --device=input
modules:
  - name: SDL3
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: git
        url: https://github.com/libsdl-org/SDL.git
        tag: release-3.2.28
    cleanup:
      - '/bin/sdl3-config'
      - '/include'
      - '/lib/libSDL3.la'
      - '/lib/libSDL3main.a'
      - '/lib/libSDL3main.la'
      - '/lib/libSDL3_test.a'
      - '/lib/libSDL3_test.la'
      - '/lib/cmake'
      - '/share/aclocal'
      - '/lib/pkgconfig'
    modules:
      - name: libdecor
        buildsystem: meson
        config-opts:
          - -Ddemo=false
        sources:
          - type: git
            url: https://gitlab.freedesktop.org/libdecor/libdecor.git
            tag: 0.2.4
  - name: SDL_ttf
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: git
        url: https://github.com/libsdl-org/SDL_ttf.git
        tag: release-3.2.2
    cleanup:
      - '/include'
      - '/lib/cmake'
      - '/share/aclocal'
      - '/lib/pkgconfig'
  - name: SDL_image
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: git
        url: https://github.com/libsdl-org/SDL_image.git
        tag: release-3.2.4
    cleanup:
      - '/include'
      - '/lib/cmake'
      - '/share/aclocal'
      - '/lib/pkgconfig'
  - name: chart
    buildsystem: simple
    build-commands:
      - unzip ensdf_251201.zip -d data/ensdf/
      - make all -j ${FLATPAK_BUILDER_N_JOBS}
      # rename executable for compatibility with KDE task manager
      # which assumes the same name for the executable and .desktop file
      - mv chart io.github.e_j_w.ChartOfNuclides
      - sed -i 's/=chart/=io.github.e_j_w.ChartOfNuclides/g' data/io.github.e_j_w.ChartOfNuclides.desktop
      # install
      - install -Dm755 io.github.e_j_w.ChartOfNuclides -t /app/bin
      - install -Dm644 chart.dat -t /app/share
      - install -Dm644 data/io.github.e_j_w.ChartOfNuclides.metainfo.xml -t /app/share/metainfo
      - install -Dm644 data/io.github.e_j_w.ChartOfNuclides.svg -t /app/share/icons/hicolor/scalable/apps
      - install -Dm644 data/io.github.e_j_w.ChartOfNuclides.desktop -t /app/share/applications
    sources:
      - type: git
        url: https://github.com/e-j-w/ChartOfNuclides.git
      # Latest ENSDF dataset (website: https://www.nndc.bnl.gov/ensdfarchivals/)
      # Redistribution: public domain, as a work of the US federal government (DOE Office of Science)
      - type: file
        url: https://www.nndc.bnl.gov/ensdfarchivals/distributions/dist25/ensdf_251201.zip
        sha256: f88fb351e7999d569ef4b0ab45a220af885ca5a5d44920c4f510b61b2a38292c
